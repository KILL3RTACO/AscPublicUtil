(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;h=Math.abs,o=Math.min,n=Math.max,p=Math.sqrt,j=function(a,b,c){return b*c+a},i=function(a,b){return{x:a%b,y:Math.floor(a/b)}},a=1,b=1,c=1.4,m=function(d,e,g){var i,j,k;return"function"==typeof g?g.call(null,d,e):g===f.OCTILE||g===f.CHEBYSHEV?(i=g===f.OCTILE?c:b,j=h(d.x-e.x),k=h(d.y-e.y),a*(j+k)+(i-2*a)*o(j,k)):h(d.x-e.x)+h(d.y-e.y)},l=m,g=function(){function a(a){null==a&&(a=[]),this.__list=a,this.size()>0&&this.sort()}return a.prototype.put=function(a,b){this.__list.push({data:a,priority:b})},a.prototype.get=function(){return this.__list.shift().data},a.prototype.sort=function(){return this.__list.sort(function(a,b){return a.priority-b.priority})},a.prototype.size=function(){return this.__list.length},a.prototype.isEmpty=function(){return 0===this.size()},a}(),k=function(a,b,c,d){var e,f,g,h,j,k,l;for(e=c,k=[e];e!==b;)e=a[e],k.push(e);for(k.reverse(),l=[],f=0,h=k.length;h>f;f++)g=k[f],j=i(g,d.getWidth()),l.push(d.get(j.x,j.y));return l},f=function(){function a(b){var c,d,e;if(this.__grid=b.grid,c=null!=(e=b.distanceFormula)?e:this.constructor.MANHATTAN,d=b.impossibleCost,void 0===this.__grid||null===this.__grid)throw new Error("Pathfinder needs a grid");if(!(this.__grid instanceof a.Grid))throw new Error("options.grid must be an instance of Pathfinder.Grid");this.__dFormula=Number.isInteger(c)||"function"==typeof c?c:this.constructor.MANHATTAN,this.__impossibleCost=Number.isInteger(d)?d:1e4}return a.MANHATTAN=0,a.OCTILE=1,a.CHEBYSHEV=2,a.prototype.getGrid=function(){return this.__grid},a.prototype.findPath=function(a,b){var c,d,e,f,h,i,m,n,o,p,q,r,s,t,u;for(f=new g([{data:a,priority:0}]),c=[],u=[],t=j(a.x,a.y,this.__grid.getWidth()),c[t]=null,u[t]=0;!f.isEmpty();){if(d=f.get(),e=j(d.x,d.y,this.__grid.getWidth()),d===b)return k(c,t,j(b.x,b.y,this.__grid.getWidth()),this.__grid);for(h=!1,s=this.__grid.getAllowedNeighbors(d.x,d.y),i=0,m=s.length;m>i;i++)o=s[i],q=j(o.x,o.y,this.__grid.getWidth()),n=u[e]+o.getMovementCost(),null===o||void 0===o||o.isWall()||n>=this.__impossibleCost||(p=u[q],(null===p||void 0===p||p>n)&&(u[q]=n,r=n+l(o,b,this.__dFormula),f.put(o,r),c[q]=e,h=!0));h&&f.sort()}return null},a}(),f.Node=e=function(){function a(a,b,c,d){this.x=a,this.y=b,this.__directions=null!=c?c:[!1,!1,!1,!1,!1,!1,!1,!1],this.__movementCost=null!=d?d:1}return a.WALL=-1,a.UP=0,a.DOWN=1,a.LEFT=2,a.RIGHT=3,a.TOP_LEFT=4,a.TOP_RIGHT=5,a.BOTTOM_LEFT=6,a.BOTTOM_RIGHT=7,a.defaultOptions=function(){var a,b,c,d,e;for(d={x:0,y:0},e=["up","down","left","right","topLeft","topRight","bottomLeft","bottomRight"],a=0,c=e.length;c>a;a++)b=e[a],d[b]=!0;return d},a.fromObject=function(a){var b,c,d,e,f;if(null===a)return null;if(a.wall)return new this(a.x,a.y,null,a.movementCost);b=[],d={up:this.UP,down:this.DOWN,left:this.LEFT,right:this.RIGHT,topLeft:this.TOP_LEFT,topRight:this.TOP_RIGHT,bottomLeft:this.BOTTOM_LEFT,bottomRight:this.BOTTOM_RIGHT};for(c in d)e=d[c],f=a[c],b[e]=null===f||void 0===f?!0:f;return new this(a.x,a.y,b)},a.getDeltas=function(a){return a===this.DOWN?{x:0,y:1}:a===this.UP?{x:0,y:-1}:a===this.LEFT?{x:-1,y:0}:a===this.BOTTOM_LEFT?{x:-1,y:1}:a===this.TOP_LEFT?{x:-1,y:-1}:a===this.RIGHT?{x:1,y:0}:a===this.BOTTOM_RIGHT?{x:1,y:1}:a===this.TOP_RIGHT?{x:1,y:-1}:void 0},a.prototype.setDirectionAllowed=function(a,b){return null==b&&(b=!0),this.__directions[a]=b===!0},a.prototype.canGo=function(a){return this.__directions[a]},a.prototype.setMovementCost=function(a){this.__movementCost=a},a.prototype.getMovementCost=function(){return this.__movementCost},a.prototype.getAllowedNeighbors=function(){var a;return a=[],this.canGo(this.constructor.TOP_LEFT)&&a.push({x:this.x-1,y:this.y-1}),this.canGo(this.constructor.UP)&&a.push({x:this.x,y:this.y-1}),this.canGo(this.constructor.TOP_RIGHT)&&a.push({x:this.x+1,y:this.y-1}),this.canGo(this.constructor.LEFT)&&a.push({x:this.x-1,y:this.y}),this.canGo(this.constructor.RIGHT)&&a.push({x:this.x+1,y:this.y}),this.canGo(this.constructor.BOTTOM_LEFT)&&a.push({x:this.x-1,y:this.y+1}),this.canGo(this.constructor.DOWN)&&a.push({x:this.x,y:this.y+1}),this.canGo(this.constructor.BOTTOM_RIGHT)&&a.push({x:this.x+1,y:this.y+1}),a},a.prototype.isWall=function(){return 0===this.getAllowedNeighbors().length},a}(),f.Grid=d=function(){function a(a,b,c){this.__grid=a,this.__width=b,this.__height=c}return a.prototype.getHeight=function(){return this.__height},a.prototype.getWidth=function(){return this.__width},a.prototype.getNodes=function(a){var b,c,d,e,f,g,h;if(!Array.isArray(a))throw new Error("list must be an array");for(b=[],c=0,d=a.length;d>c;c++)f=a[c],g=f.x,h=f.y,0>g||g>=this.__width||0>h||h>=this.__height||(e=this.get(g,h),null!==e&&void 0!==e&&b.push(e));return b},a.prototype.getAllowedNeighbors=function(a,b){var c;return c=this.get(a,b),null===c||void 0===c?null:this.getNodes(c.getAllowedNeighbors())},a.prototype.get=function(a,b){return this.__grid[j(a,b,this.__width)]},a.prototype.set=function(a,b,c){return this.__grid[j(a,b,this.__width)]=c,this},a}(),"object"==typeof module&&"object"==typeof module.exports?module.exports=f:window.Pathfinder=f}).call(this);